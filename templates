<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Q&A System</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general aesthetics */
        :root {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 800px;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

    <div class="container mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-700">LLM Question-and-Answering System</h1>
            <p class="text-gray-600 mt-2">Powered by the Gemini API (Flask Backend)</p>
        </header>

        <!-- Input Form -->
        <div class="card bg-white p-6 rounded-xl mb-8">
            <form id="qa-form">
                <label for="question" class="block text-lg font-medium text-gray-700 mb-2">Enter Your Question:</label>
                <textarea id="question" name="question" rows="4" 
                          class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-3 text-gray-800"
                          placeholder="e.g., What are the main benefits of using solar energy?" required></textarea>
                
                <div class="flex justify-end mt-4">
                    <button type="submit" id="submit-button"
                            class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-150 ease-in-out">
                        Get Answer
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden text-center text-indigo-600 font-medium my-4">
            <svg class="animate-spin h-5 w-5 mr-3 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Processing...
        </div>

        <!-- Output Display Area -->
        <div class="space-y-6">
            <!-- LLM Answer -->
            <div class="card bg-white p-6 rounded-xl border-t-4 border-indigo-500">
                <h2 class="text-2xl font-bold text-gray-800 mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.03 12.03 0 003 12c0 2.915.823 5.666 2.222 8.016A12.048 12.048 0 0012 22c2.915 0 5.666-.823 8.016-2.222A12.03 12.03 0 0021 12c0-2.915-.823-5.666-2.222-8.016z"></path></svg>
                    LLM Answer
                </h2>
                <div id="llm-answer" class="text-gray-900 leading-relaxed whitespace-pre-wrap">
                    Your answers will appear here.
                </div>
            </div>

            <!-- Details Panel (Preprocessing & Raw Response) -->
            <div class="card bg-white p-6 rounded-xl border-t-4 border-gray-400">
                <h2 class="text-2xl font-bold text-gray-800 mb-3 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                    Request Details
                </h2>
                
                <div class="space-y-4 text-sm">
                    <div>
                        <p class="font-semibold text-gray-700">Preprocessed Query (Sent to LLM):</p>
                        <code id="processed-query" class="block bg-gray-50 p-2 rounded text-gray-600">N/A</code>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-700">Raw API Response (JSON):</p>
                        <pre id="raw-response" class="block bg-gray-50 p-2 rounded text-xs text-gray-600 overflow-x-auto h-40">N/A</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('qa-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const question = document.getElementById('question').value.trim();
            const submitButton = document.getElementById('submit-button');
            const loadingIndicator = document.getElementById('loading');
            const llmAnswer = document.getElementById('llm-answer');
            const processedQuery = document.getElementById('processed-query');
            const rawResponse = document.getElementById('raw-response');

            // Reset previous results
            llmAnswer.innerHTML = 'Thinking...';
            processedQuery.textContent = 'Processing...';
            rawResponse.textContent = 'Waiting for response...';
            submitButton.disabled = true;
            loadingIndicator.classList.remove('hidden');
            llmAnswer.classList.remove('text-red-600');
            llmAnswer.classList.add('text-gray-900');


            try {
                const response = await fetch('/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: question })
                });

                const data = await response.json();
                
                // Update processed query and raw response
                processedQuery.textContent = data.processed || 'N/A';
                rawResponse.textContent = data.raw_response ? JSON.stringify(JSON.parse(data.raw_response), null, 2) : 'N/A';

                if (response.ok && !data.error) {
                    llmAnswer.innerHTML = data.message.replace(/\n/g, '<br>');
                } else {
                    llmAnswer.innerHTML = `<strong>ERROR:</strong> ${data.message || 'An unknown error occurred.'}`;
                    llmAnswer.classList.remove('text-gray-900');
                    llmAnswer.classList.add('text-red-600');
                }

            } catch (error) {
                console.error('Fetch error:', error);
                llmAnswer.innerHTML = `<strong>FATAL NETWORK ERROR:</strong> Could not connect to the Flask server. (${error.message})`;
                llmAnswer.classList.remove('text-gray-900');
                llmAnswer.classList.add('text-red-600');
                rawResponse.textContent = error.toString();

            } finally {
                submitButton.disabled = false;
                loadingIndicator.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
